define("klog/blogs/comment-form",["./comment-tip","_","$"],function(a){var b=a("_"),c=a("$"),d=a("./comment-tip");d.init();var e={init:function(){b.bindAll(this),this.$el=c("#new_comment"),this.$el.on("ajax:success",this.handleSubmit),c("#submitComment").click(this.submit),c("#cancelReply").click(this.cancelReply),c("#captcha").on("focus blur",this.toggleCaptcha),c("#comment_content").keydown(this.handleHotkey),setInterval(this.enableSubmit,500)},handleSubmit:function(a,b){b.success?(this.cancelReply(),c("#comment_content").val(""),c("#commentsWrapper").load(this.$el.attr("action")),d.show({success:"评论成功！"})):(c("#submitComment").removeClass("disabled"),d.show({error:b.errors}))},handleHotkey:function(a){13===a.which&&a.ctrlKey&&c("#submitComment").click()},submit:function(a){c("#submitComment").hasClass("disabled")?a.preventDefault():c("#submitComment").addClass("disabled")},replyTo:function(a){this.$el.css("margin-left","20px").insertAfter(a.parent()),c("#cancelReply").show(),c("#comment_commentable_id").val(a.data("commentid")),c("#comment_commentable_type").val("Comment"),c("#comment_content").focus()},cancelReply:function(){this.$el.css("margin-left",0).insertAfter("#commentsWrapper"),c("#cancelReply").hide(),c("#comment_commentable_id").val(c("#comment_commentable_id").data("origin")),c("#comment_commentable_type").val("Blog")},toggleCaptcha:function(){var a=c("#captcha").position();c("#captcha").next().toggle("fast").css({left:a.left+10,top:a.top-40})},enableSubmit:function(){var a=b(c("#comment_content, #comment_nick, #comment_email, #captcha")).every(function(a){return c.trim(a.value).length>0});c("#submitComment").toggleClass("btn-primary",a).toggleClass("disabled",!a),c("#submitComment").find("i").toggleClass("icon-white",a)}};return e}),define("klog/blogs/comment-tip",["_","$"],function(a){var b=a("_"),c=a("$"),d={init:function(){b.bindAll(this),this.$el=c('<div class="comment-tip"><i></i> <span></span></div>').appendTo("#new_comment"),this.calcPos()},calcPos:function(){var a=c("#comment_content").position(),b=c("#comment_content").outerHeight(),d=c("#comment_content").outerWidth();this.left=a.left+d/2,this.top=a.top+b/2},show:function(a){a.success?(this.$el.find("span").text(a.success),this.$el.find("i").attr("class","icon-ok icon-white")):a.error&&(this.$el.find("span").text(a.error),this.$el.find("i").attr("class","icon-exclamation-sign icon-white"));var b=this.$el.outerHeight(),c=this.$el.outerWidth();this.$el.css({top:this.top-.5*b+"px",left:this.left-.5*c+"px",visibility:"visible"}).fadeIn(),setTimeout(this.hide,1500)},hide:function(){this.$el.fadeOut()}};return d}),define("klog/blogs/show",["./comment-form","./comment-tip","_","$","jquery.color","jquery-ujs"],function(a){a("_");var d=a("$");a("jquery.color"),a("jquery-ujs");var e=a("./comment-form");if(e.init(),d(document).on("click","a.reply-comment",function(){e.replyTo(d(this))}),/^#comments_(\d+)$/.test(location.hash)){var f=d(location.hash).find("header"),g=0,h=function(){3>g++&&f.animate({backgroundColor:"#fcf8e3"},"normal","linear",i)},i=function(){f.animate({backgroundColor:"#eee"},"normal","linear",h)};h()}IS_ADMIN&&a.async("../admin/common/pop-confirm",function(a){var b=new a;d("#commentsWrapper").on("click","a.delete",function(a){a.preventDefault(),a.stopImmediatePropagation();var c=d(this);return b.show({text:"确定删除？",trigger:this}),b.off().on("submit",function(){c.trigger("click.rails")}),!1}),d(document).on("ajax:success","a.delete",function(){d(this).closest("article").hide("normal")}),d(document).on("ajax:error","a.delete",function(){confirm("出错啦！刷新下页面吧？")&&location.reload()})})});